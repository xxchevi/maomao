import{_ as et,u as Z,c as u,o as v,a as t,e as _,d as y,f as e,t as i,n as $,F as Q,r as T,g as w,h as st,i as it,j as tt,k as nt,v as lt,l as ot,m as at,p as dt,q as rt,b as Y,s as ct}from"./C_JLxRH9.js";import{u as mt}from"./8g37b03D.js";const ut={class:"game-card"},vt={key:0,class:"mb-6"},xt={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},gt={class:"flex justify-between items-center mb-2"},pt={class:"font-semibold"},yt={class:"text-sm text-gray-600"},ft={class:"space-y-2"},bt={class:"flex justify-between items-center text-sm"},_t={class:"font-semibold"},ht={class:"relative h-3 bg-gray-200 rounded-full overflow-hidden"},kt={class:"flex justify-between items-center text-xs text-gray-500"},$t={key:1},wt={class:"text-md font-medium mb-3 text-orange-600"},Ct={class:"space-y-2 max-h-64 overflow-y-auto"},Qt={class:"flex-1"},Tt={class:"font-medium text-sm"},Lt={class:"text-xs text-gray-600"},It={class:"flex items-center space-x-2"},Mt={class:"text-xs text-gray-500"},jt=["onClick"],Rt={key:2,class:"text-center py-8 text-gray-500"},St={__name:"QueuePanel",setup(C){const m=Z(),p=c=>({mining:"挖矿",gathering:"采集",fishing:"钓鱼",cooking:"烹饪",crafting:"制作"})[c]||c,o=c=>{const r=Number(c)||0;if(r<60)return`${r}秒`;if(r<3600){const g=Math.floor(r/60),f=r%60;return`${g}分${f}秒`}else{const g=Math.floor(r/3600),f=Math.floor(r%3600/60);return`${g}小时${f}分钟`}},d=()=>{m.stopCurrentQueue()},b=c=>{m.removeFromQueue(c)};return(c,r)=>(v(),u("div",ut,[r[4]||(r[4]=t("h3",{class:"text-lg font-semibold mb-4 flex items-center"},[t("span",{class:"mr-2"},"📋"),y(" 操作队列 ")],-1)),e(m).currentQueue?(v(),u("div",vt,[r[2]||(r[2]=t("h4",{class:"text-md font-medium mb-3 text-blue-600"},"当前执行",-1)),t("div",xt,[t("div",gt,[t("span",pt,i(p(e(m).currentQueue.activityType))+" - "+i(e(m).currentQueue.resourceName),1),t("span",yt,i(e(m).currentQueue.currentRepeat)+"/"+i(e(m).currentQueue.totalRepeat),1)]),t("div",ft,[t("div",bt,[r[0]||(r[0]=t("span",null,"单次进度:",-1)),t("span",_t,i(Math.floor(e(m).currentQueue.progress||0))+"%",1)]),t("div",ht,[t("div",{class:"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-400 to-blue-600 rounded-full transition-all duration-100 ease-linear",style:$({width:(e(m).currentQueue.progress||0)+"%"})},r[1]||(r[1]=[t("div",{class:"absolute top-0 left-0 w-full h-full bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"},null,-1)]),4)]),t("div",kt,[t("span",null,"剩余时间: "+i(o(e(m).currentQueue.remainingTime||0)),1),t("span",null,"总进度: "+i(Math.floor(((e(m).currentQueue.currentRepeat||1)-1+(e(m).currentQueue.progress||0)/100)/(e(m).currentQueue.totalRepeat||1)*100))+"%",1)])]),t("button",{onClick:d,class:"mt-3 w-full bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-md text-sm"}," 停止队列 ")])])):_("",!0),e(m).pendingQueues.length>0?(v(),u("div",$t,[t("h4",wt,"待开始队列 ("+i(e(m).pendingQueues.length)+"/20)",1),t("div",Ct,[(v(!0),u(Q,null,T(e(m).pendingQueues,(g,f)=>(v(),u("div",{key:g.id,class:"bg-orange-50 border border-orange-200 rounded-lg p-3 flex justify-between items-center"},[t("div",Qt,[t("div",Tt,i(p(g.activityType))+" - "+i(g.resourceName),1),t("div",Lt,"执行 "+i(g.totalRepeat||1)+" 次 | 预计 "+i(o(g.estimatedTime||0)),1)]),t("div",It,[t("span",Mt,"#"+i(f+1),1),t("button",{onClick:k=>b(g.id),class:"text-red-500 hover:text-red-700 text-sm",title:"移除队列"}," ✕ ",8,jt)])]))),128))])])):_("",!0),!e(m).currentQueue&&e(m).pendingQueues.length===0?(v(),u("div",Rt,r[3]||(r[3]=[t("div",{class:"text-4xl mb-2"},"📋",-1),t("div",{class:"text-sm"},"暂无队列任务",-1),t("div",{class:"text-xs mt-1"},"点击资源区域开始活动",-1)]))):_("",!0)]))}},At=et(St,[["__scopeId","data-v-7504ab6f"]]),Et={class:"flex justify-between items-center mb-4"},Nt={class:"text-lg font-semibold"},Bt={key:0,class:"text-center py-8"},Ft={key:1,class:"mb-6"},Ot={class:"text-sm text-gray-600 mb-2"},Vt={class:"font-semibold text-blue-600"},zt={class:"text-sm text-gray-600 mb-4"},Pt={class:"ml-4 space-y-1"},Dt={class:"text-sm text-gray-600 mb-4"},qt={class:"text-yellow-600"},Gt={class:"text-xs text-gray-500 mb-4"},Ht={class:"mb-6"},Ut={class:"flex items-center space-x-2"},Jt={class:"mb-6"},Kt={class:"grid grid-cols-4 gap-2"},Wt={class:"grid grid-cols-2 gap-2 mt-2"},Xt={class:"mb-6 text-center"},Yt={class:"text-sm text-gray-600"},Zt={class:"font-semibold text-blue-600"},te={__name:"ActivityModal",props:{isOpen:{type:Boolean,default:!1},activityType:{type:String,default:""},resource:{type:Object,default:null}},emits:["close","addToQueue","startImmediately"],setup(C,{emit:m}){const p=C,o=m,d=w(1),b=w(!1),c=w(null),r=st(()=>c.value?c.value.resource.baseTime*d.value:0),g=async()=>{if(!(!p.resource||!p.activityType)){b.value=!0;try{const{data:x}=await $fetch("/api/game/resource-info",{query:{resourceId:p.resource.id,activityType:p.activityType}});c.value=x}catch(x){console.error("Failed to fetch resource info:",x)}finally{b.value=!1}}},f=()=>{o("close")},k=x=>{if(!c.value)return;const l=c.value.resource.baseTime;let h=0;x==="30m"?h=Math.floor(1800/l):x==="1h"&&(h=Math.floor(3600/l)),d.value+=h},M=()=>{var x;o("addToQueue",{activityType:p.activityType,resourceId:(x=p.resource)==null?void 0:x.id,repeatCount:d.value}),f()},j=()=>{var x;o("startImmediately",{activityType:p.activityType,resourceId:(x=p.resource)==null?void 0:x.id,repeatCount:d.value}),f()};return it(()=>p.isOpen,x=>{x&&(d.value=1,c.value=null,g())}),(x,l)=>{var h;return C.isOpen?(v(),u("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:f},[t("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",onClick:l[7]||(l[7]=at(()=>{},["stop"]))},[t("div",Et,[t("h3",Nt,i(((h=C.resource)==null?void 0:h.name)||"活动选择"),1),t("button",{onClick:f,class:"text-gray-500 hover:text-gray-700"}," ✕ ")]),e(b)?(v(),u("div",Bt,l[8]||(l[8]=[t("div",{class:"text-gray-500"},"加载中...",-1)]))):e(c)?(v(),u("div",Ft,[t("div",Ot,[l[9]||(l[9]=y(" 耗时: ",-1)),t("span",Vt,i(e(c).resource.baseTime)+"秒",1)]),t("div",zt,[l[10]||(l[10]=y(" 获得: ",-1)),t("div",Pt,[(v(!0),u(Q,null,T(e(c).drops,a=>(v(),u("div",{key:a.item.id,class:"flex items-center"},[t("span",{class:tt(`w-2 h-2 ${a.color} rounded-full mr-2`)},null,2),y(" "+i(a.item.name)+": "+i(a.minQuantity)+i(a.maxQuantity>a.minQuantity?` ~ ${a.maxQuantity}`:"")+" ("+i((a.dropRate*100).toFixed(1))+"%) ",1)]))),128))])]),t("div",Dt,[l[11]||(l[11]=y(" 提升: ",-1)),t("span",qt,"🏆 "+i(e(c).skillExp.type)+": "+i(e(c).skillExp.amount)+" 经验",1)]),t("div",Gt," 当前技能等级: "+i(e(c).skillLevel),1)])):_("",!0),t("div",Ht,[l[13]||(l[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"执行次数",-1)),t("div",Ut,[nt(t("input",{"onUpdate:modelValue":l[0]||(l[0]=a=>ot(d)?d.value=a:null),type:"number",min:"1",max:"999",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},null,512),[[lt,e(d),void 0,{number:!0}]]),l[12]||(l[12]=t("span",{class:"text-sm text-gray-500"},"次",-1))])]),t("div",Jt,[l[14]||(l[14]=t("div",{class:"text-sm text-gray-600 mb-2"},"快速操作:",-1)),t("div",Kt,[t("button",{onClick:l[1]||(l[1]=a=>d.value=10),class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"},"+10"),t("button",{onClick:l[2]||(l[2]=a=>d.value=100),class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"},"+100"),t("button",{onClick:l[3]||(l[3]=a=>d.value=1e3),class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"},"+1000"),t("button",{onClick:l[4]||(l[4]=a=>k("30m")),class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"},"+30分钟")]),t("div",Wt,[t("button",{onClick:l[5]||(l[5]=a=>k("1h")),class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"},"+1小时"),t("button",{onClick:l[6]||(l[6]=a=>k("1h")),class:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded"},"+1小时")])]),t("div",Xt,[t("div",Yt,[l[15]||(l[15]=y(" 预计耗时: ",-1)),t("span",Zt,i(e(r))+"秒",1)])]),t("div",{class:"flex space-x-3"},[t("button",{onClick:M,class:"flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md font-medium flex items-center justify-center"}," 📋 加入队列 "),t("button",{onClick:j,class:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded-md font-medium flex items-center justify-center"}," ⚡ 立即开始 ")])])])):_("",!0)}}},ee={class:"space-y-6"},se={key:0,class:"game-card"},ie={key:0,class:"text-center py-8"},ne={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},le={class:"text-center"},oe={class:"text-sm text-gray-600"},ae={class:"font-semibold"},de={class:"text-center"},re={class:"font-semibold"},ce={class:"text-center"},me={class:"font-semibold text-yellow-600"},ue={class:"text-center"},ve={key:1,class:"game-card"},xe={key:2,class:"game-card"},ge={class:"grid md:grid-cols-2 gap-4"},pe={class:"space-y-3"},ye={class:"flex justify-between items-center"},fe={class:"font-semibold"},be={class:"skill-bar"},_e={class:"flex justify-between items-center"},he={class:"font-semibold"},ke={class:"skill-bar"},$e={class:"flex justify-between items-center"},we={class:"font-semibold"},Ce={class:"skill-bar"},Qe={class:"space-y-3"},Te={class:"flex justify-between items-center"},Le={class:"font-semibold"},Ie={class:"skill-bar"},Me={class:"flex justify-between items-center"},je={class:"font-semibold"},Re={class:"skill-bar"},Se={class:"space-y-6"},Ae={class:"game-card"},Ee={class:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},Ne=["onClick"],Be={class:"flex-1"},Fe={class:"font-semibold"},Oe={class:"text-sm text-gray-600"},Ve={class:"text-xs text-gray-500"},ze={class:"game-card"},Pe={class:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},De=["onClick"],qe={class:"flex-1"},Ge={class:"font-semibold"},He={class:"text-sm text-gray-600"},Ue={class:"text-xs text-gray-500"},Je={class:"game-card"},Ke={class:"grid md:grid-cols-2 lg:grid-cols-3 gap-4"},We=["onClick"],Xe={class:"flex-1"},Ye={class:"font-semibold"},Ze={class:"text-sm text-gray-600"},ts={class:"text-xs text-gray-500"},is={__name:"game",async setup(C){let m,p;const o=dt(),d=Z();o.isLoggedIn||([m,p]=rt(()=>ct("/login")),await m,p());const b=w(!1),c=w(""),r=w(null),g=(a,s)=>{c.value=a,r.value=s,b.value=!0},f=()=>{b.value=!1,c.value="",r.value=null},k=async a=>{await d.addToQueue(a)},M=async a=>{await d.startImmediately(a)},j=async()=>{try{const a=prompt("请输入角色名称:");if(!a)return;const{data:s}=await $fetch("/api/auth/create-character",{method:"POST",headers:{Authorization:`Bearer ${o.token}`},body:{name:a}});o.updateCharacter(s.character),d.initSocket(),await d.loadGameData()}catch(a){console.error("创建角色失败:",a),alert("创建角色失败，请重试")}},x=(a,s)=>{const L=(s-1)*(s-1)*100,R=s*s*100,I=(a-L)/(R-L)*100;return Math.max(0,Math.min(100,I))},l=()=>{d.socket&&(d.socket.emit("test_create_queue"),console.log("发送创建测试队列请求"))},h=()=>{d.socket&&(d.socket.emit("restore_queues"),console.log("发送恢复队列请求"))};return mt({title:"游戏 - 猫猫挂机游戏"}),(a,s)=>{var I,S,A,E,N,B,F,O,V,z,P,D,q,G,H,U,J,K,W;const L=At,R=te;return v(),u("div",ee,[e(o).isLoggedIn?(v(),u("div",se,[e(o).character?_("",!0):(v(),u("div",ie,[s[0]||(s[0]=t("h3",{class:"text-xl font-semibold mb-4"},"角色不存在",-1)),s[1]||(s[1]=t("p",{class:"mb-6"},"请先创建您的游戏角色",-1)),t("button",{onClick:j,class:"btn-primary"},"创建角色")])),t("div",ne,[t("div",le,[s[2]||(s[2]=t("div",{class:"text-2xl mb-1"},"🐱",-1)),t("div",oe,i((I=e(o).character)==null?void 0:I.name),1),t("div",ae,"Lv."+i((S=e(o).character)==null?void 0:S.level),1)]),t("div",de,[s[3]||(s[3]=t("div",{class:"text-2xl mb-1"},"⭐",-1)),s[4]||(s[4]=t("div",{class:"text-sm text-gray-600"},"经验",-1)),t("div",re,i((A=e(o).character)==null?void 0:A.exp),1)]),t("div",ce,[s[5]||(s[5]=t("div",{class:"text-2xl mb-1"},"💰",-1)),s[6]||(s[6]=t("div",{class:"text-sm text-gray-600"},"金币",-1)),t("div",me,i((E=e(o).character)==null?void 0:E.coins),1)]),t("div",ue,[s[7]||(s[7]=t("div",{class:"text-2xl mb-1"},"🔗",-1)),s[8]||(s[8]=t("div",{class:"text-sm text-gray-600"},"连接状态",-1)),t("div",{class:tt([e(d).isConnected?"text-green-600":"text-red-600","font-semibold"])},i(e(d).isConnected?"已连接":"未连接"),3)])])])):_("",!0),Y(L),e(o).isLoggedIn?(v(),u("div",ve,[s[9]||(s[9]=t("h2",{class:"text-xl font-bold mb-4"},"测试功能",-1)),t("div",{class:"flex gap-4"},[t("button",{onClick:l,class:"btn-primary"}," 创建测试队列 "),t("button",{onClick:h,class:"btn-secondary"}," 恢复队列状态 ")])])):_("",!0),e(o).isLoggedIn&&e(o).character?(v(),u("div",xe,[s[15]||(s[15]=t("h2",{class:"text-xl font-bold mb-4"},"技能等级",-1)),t("div",ge,[t("div",pe,[t("div",ye,[s[10]||(s[10]=t("span",{class:"flex items-center"},[t("span",{class:"mr-2"},"⛏️"),y(" 挖矿 ")],-1)),t("span",fe,"Lv."+i((N=e(o).character)==null?void 0:N.miningLevel),1)]),t("div",be,[t("div",{class:"skill-progress",style:$({width:x((B=e(o).character)==null?void 0:B.miningExp,(F=e(o).character)==null?void 0:F.miningLevel)+"%"})},null,4)]),t("div",_e,[s[11]||(s[11]=t("span",{class:"flex items-center"},[t("span",{class:"mr-2"},"🌿"),y(" 采集 ")],-1)),t("span",he,"Lv."+i((O=e(o).character)==null?void 0:O.gatheringLevel),1)]),t("div",ke,[t("div",{class:"skill-progress",style:$({width:x((V=e(o).character)==null?void 0:V.gatheringExp,(z=e(o).character)==null?void 0:z.gatheringLevel)+"%"})},null,4)]),t("div",$e,[s[12]||(s[12]=t("span",{class:"flex items-center"},[t("span",{class:"mr-2"},"🎣"),y(" 钓鱼 ")],-1)),t("span",we,"Lv."+i((P=e(o).character)==null?void 0:P.fishingLevel),1)]),t("div",Ce,[t("div",{class:"skill-progress",style:$({width:x((D=e(o).character)==null?void 0:D.fishingExp,(q=e(o).character)==null?void 0:q.fishingLevel)+"%"})},null,4)])]),t("div",Qe,[t("div",Te,[s[13]||(s[13]=t("span",{class:"flex items-center"},[t("span",{class:"mr-2"},"🍳"),y(" 烹饪 ")],-1)),t("span",Le,"Lv."+i((G=e(o).character)==null?void 0:G.cookingLevel),1)]),t("div",Ie,[t("div",{class:"skill-progress",style:$({width:x((H=e(o).character)==null?void 0:H.cookingExp,(U=e(o).character)==null?void 0:U.cookingLevel)+"%"})},null,4)]),t("div",Me,[s[14]||(s[14]=t("span",{class:"flex items-center"},[t("span",{class:"mr-2"},"🔨"),y(" 制作 ")],-1)),t("span",je,"Lv."+i((J=e(o).character)==null?void 0:J.craftingLevel),1)]),t("div",Re,[t("div",{class:"skill-progress",style:$({width:x((K=e(o).character)==null?void 0:K.craftingExp,(W=e(o).character)==null?void 0:W.craftingLevel)+"%"})},null,4)])])])])):_("",!0),t("div",Se,[t("div",Ae,[s[17]||(s[17]=t("h2",{class:"text-xl font-bold mb-4 flex items-center"},[t("span",{class:"mr-2"},"⛏️"),y(" 挖矿区域 ")],-1)),t("div",Ee,[(v(!0),u(Q,null,T(e(d).resourcesByArea("mining"),n=>(v(),u("div",{key:n.id,class:"resource-item",onClick:X=>g("mining",n)},[t("div",Be,[t("div",Fe,i(n==null?void 0:n.name),1),t("div",Oe," 需要等级: "+i(n==null?void 0:n.levelReq)+" | 经验: +"+i(n==null?void 0:n.expReward),1),t("div",Ve," 基础时间: "+i(n==null?void 0:n.baseTime)+"秒 ",1)]),s[16]||(s[16]=t("div",{class:"text-2xl"},"⛏️",-1))],8,Ne))),128))])]),t("div",ze,[s[19]||(s[19]=t("h2",{class:"text-xl font-bold mb-4 flex items-center"},[t("span",{class:"mr-2"},"🌿"),y(" 采集区域 ")],-1)),t("div",Pe,[(v(!0),u(Q,null,T(e(d).resourcesByArea("gathering"),n=>(v(),u("div",{key:n.id,class:"resource-item",onClick:X=>g("gathering",n)},[t("div",qe,[t("div",Ge,i(n==null?void 0:n.name),1),t("div",He," 需要等级: "+i(n==null?void 0:n.levelReq)+" | 经验: +"+i(n==null?void 0:n.expReward),1),t("div",Ue," 基础时间: "+i(n==null?void 0:n.baseTime)+"秒 ",1)]),s[18]||(s[18]=t("div",{class:"text-2xl"},"🌿",-1))],8,De))),128))])]),t("div",Je,[s[21]||(s[21]=t("h2",{class:"text-xl font-bold mb-4 flex items-center"},[t("span",{class:"mr-2"},"🎣"),y(" 钓鱼区域 ")],-1)),t("div",Ke,[(v(!0),u(Q,null,T(e(d).resourcesByArea("fishing"),n=>(v(),u("div",{key:n.id,class:"resource-item",onClick:X=>g("fishing",n)},[t("div",Xe,[t("div",Ye,i(n==null?void 0:n.name),1),t("div",Ze," 需要等级: "+i(n==null?void 0:n.levelReq)+" | 经验: +"+i(n==null?void 0:n.expReward),1),t("div",ts," 基础时间: "+i(n==null?void 0:n.baseTime)+"秒 ",1)]),s[20]||(s[20]=t("div",{class:"text-2xl"},"🎣",-1))],8,We))),128))])])]),Y(R,{"is-open":e(b),"activity-type":e(c),resource:e(r),onClose:f,onAddToQueue:k,onStartImmediately:M},null,8,["is-open","activity-type","resource"])])}}};export{is as default};
